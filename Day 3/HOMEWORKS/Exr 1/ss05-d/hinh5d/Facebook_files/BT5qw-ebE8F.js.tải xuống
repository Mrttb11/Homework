;/*FB_PKG_DELIM*/

__d("LSIssueRestoreTask",["LSAppendDataTraceAddon","LSIsMobileClient","LSIssueNewTaskAndGetTaskID","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueRestoreTaskStoredProcedure] Beginning execution."),c.i64.eq(a[3],c.i64.cast([0,1]))?d[1]="messages":d[1]="threads",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueRestoreTaskStoredProcedure] ","",["Restoring ",d[1]].join("")].join("")),a[5]!==f?c.sp(b("LSAppendDataTraceAddon"),a[5],c.i64.cast([0,3604]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[2]=a[0],a})},function(a){return d[2]?d[3]=!0:d[3]=!1,d[3]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[18]=c.createArray(),f!==f?d[19]=(d[18].push(f),d[18]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[18],c.i64.cast([0,3]))):c.resolve()},function(e){return a[9]!==f?d[4]=a[9]:d[4]="",c.i64.gt(c.i64.cast([0,0]),c.i64.cast([0,0]))?(d[18]=c.i64.of_float(Date.now()),d[5]=c.i64.add(d[18],c.i64.cast([0,0]))):d[5]=c.i64.cast([0,0]),c.sp(b("LSIssueNewTaskAndGetTaskID"),["encrypted_backups_restore",":",d[4]].join(""),c.i64.cast([0,50015]),"",f,f,c.i64.cast([0,0]),c.i64.cast([0,0]),f,f,d[5]).then(function(a){return a=a,d[6]=a[0],a})},function(d){return a[5]!==f?c.sp(b("LSAppendDataTraceAddon"),a[5],c.i64.cast([0,3601]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[7]=a[0],a})},function(a){return d[7]?d[8]=!0:d[8]=!1,d[8]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[18]=c.createArray(),f!==f?d[19]=(d[18].push(f),d[18]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[18],c.i64.cast([0,3]))):c.resolve()},function(b){return c.db.table(190).add({taskId:d[6],mailboxPartialId:a[0],listId:a[1],numItems:a[2],contentType:a[3],startSortKey:a[4],traceId:a[5],isPointQuery:!1,newerNumItems:a[7],unencryptedSortKey:a[8],serverThreadKey:a[9],waThreadId:a[10]})},function(d){return a[5]!==f?c.sp(b("LSAppendDataTraceAddon"),a[5],c.i64.cast([0,3605]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!0:d[10]=!1,d[10]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[18]=c.createArray(),f!==f?d[19]=(d[18].push(f),d[18]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[18],c.i64.cast([0,3]))):c.resolve()},function(a){return d[11]=c.i64.of_float(Date.now()),d[13]="Finishing execution. Execution time: ",d[14]=c.i64.to_string(c.i64.sub(d[11],d[0])),d[16]=" ms",d[12]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueRestoreTaskStoredProcedure] ",d[12],d[13],d[12],d[14],d[12],d[16]].join("")),d[15]=",",d[17]=c.createArray(),f!==f?d[18]=(d[17].push(f),d[17]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueRestoreTaskStoredProcedure",[d[13],d[15],d[14],d[15],d[16]].join(""),d[17],c.i64.cast([0,4]))},function(a){return e[0]=d[6]}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSLoadThreadPkFromThreadId",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadThreadPkFromThreadId] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.ftr(c.db.table(173).fetch(),function(b){return c.i64.to_string(b.jid)===a[0]}).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[14]=new c.Map(),d[14].set("error_code",c.i64.cast([0,100])),d[14].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[14].set("error_message",""),e=[f,d[14]],d[2]=e[0],d[3]=e[1],e):(b=a.item,e=[b.clientThreadPk,f],d[2]=e[0],d[3]=e[1],e)})},function(a){return c.i64.neq(d[2],f)?(a=[d[2],d[3]],d[5]=a[0],d[6]=a[1],a):(d[14]=new c.Map(),d[14].set("error_code",c.i64.cast([0,7])),d[14].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[14].set("error_message",""),c.i64.neq(f,f)?(a=[f,d[14]],d[15]=a[0],d[16]=a[1],a):(d[17]=new c.Map(),d[17].set("error_code",c.i64.cast([0,100])),d[17].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[17].set("error_message",""),a=[f,d[17]],d[15]=a[0],d[16]=a[1],a),a=[d[15],d[16]],d[5]=a[0],d[6]=a[1],a),d[7]=c.i64.of_float(Date.now()),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[12]=" ms",d[8]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadThreadPkFromThreadId] ",d[8],d[9],d[8],d[10],d[8],d[12]].join("")),d[11]=",",d[13]=c.createArray(),f!==f?d[14]=(d[13].push(f),d[13]):0,c.nop(b("LSLogMebClientEvent.nop"),"loadThreadPkFromThreadId",[d[9],d[11],d[10],d[11],d[12]].join(""),d[13],c.i64.cast([0,4]))},function(a){return a=[d[5],d[6]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSIssueMessageRangeQueryTask",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSBinaryToHex.nop","LSCreateDataTrace","LSCreateDataTraceID.nop","LSCreateDerivedKeys.nop","LSFlushDataTrace.nop","LSGetBlobFromInt64BE.nop","LSGetBlobFromString.nop","LSGetThreadTransportIdFromThreadId.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewTask","LSIssueRestoreTask","LSLoadThreadPkFromThreadId","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSOpeEncrypt.nop","LSTruncateSortKey.nop","gkx","justknobx","qex"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1];d.n;var e=[],f=[],g;return d.seq([function(f){return d.seq([function(f){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] Beginning execution."),!a[3]&&c("gkx")("1783")?(e[10]=d.i64.gt(a[1],d.i64.cast([0,0]))&&d.i64.gt(a[5],d.i64.cast([0,0])),d.islc(d.ftr(d.db.table(168).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))||!1}),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(c,f){var h=c.done;c=c.value;return h?d.seq([function(c){return e[10]?(e[11]=new d.Map(),e[11].set("error_code",d.i64.cast([0,1])),e[11].set("error_message",""),e[11].set("stored_procedure","issueMessageRangeQueryTask"),e[12]=new d.Map(),e[12].set("act_thread_id",a[0]),e[13]=new d.Map(),e[13].set("restore_context",e[12]),e[13].set("failure",e[11]),e[14]=d.toJSON(e[13]),d.sp(b("LSIssueNewTask"),"encrypted_backups_restore",d.i64.cast([0,50031]),e[14],g,g,d.i64.cast([0,0]),d.i64.cast([0,0]),g,g,d.i64.cast([0,0]))):(e[11]=new d.Map(),e[11].set("error_code",d.i64.cast([0,1])),e[11].set("error_message",""),e[11].set("stored_procedure","issueMessageRangeQueryTask"),e[12]=new d.Map(),e[12].set("act_thread_id",a[0]),e[13]=new d.Map(),e[13].set("restore_context",e[12]),e[13].set("failure",e[11]),e[14]=d.toJSON(e[13]),d.sp(b("LSIssueNewTask"),"encrypted_backups_restore",d.i64.cast([0,50030]),e[14],g,g,d.i64.cast([0,0]),d.i64.cast([0,0]),g,g,d.i64.cast([0,0])))},function(a){return e[8]=!1}]):(f=c.item,d.seq([function(a){return e[19]=f.mailboxRootKeyBlob,e[18]=f.ocmfClientStateBlob,e[17]=f.deviceId,e[16]=f.backupTenancy,e[15]=f.encryptionVersion,d.i64.neq(g,g)?d.resolve(e[11]=g):d.seq([function(a){return e[20]=d.createArray(),d.sp(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,0])).then(function(a){return a=a,e[21]=a[0],a})},function(a){return e[21]?e[30]=(e[20].push(d.i64.cast([0,0])),e[20]):0,d.sp(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,2])).then(function(a){return a=a,e[22]=a[0],a})},function(a){return e[22]?e[30]=(e[20].push(d.i64.cast([0,2])),e[20]):0,d.sp(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,3])).then(function(a){return a=a,e[23]=a[0],a})},function(a){return e[23]?e[30]=(e[20].push(d.i64.cast([0,3])),e[20]):0,d.sp(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,4])).then(function(a){return a=a,e[24]=a[0],a})},function(a){return e[24]?e[30]=(e[20].push(d.i64.cast([0,4])),e[20]):0,e[25]=d.createArray(),e[26]=d.i64.of_int32(e[20].length),d.i64.gt(e[26],d.i64.cast([0,0]))?d.loopAsync(e[26],function(a){return e[30]=a,d.seq([function(a){return d.ntop("Array",b("LSArrayGetObjectAt"),e[20],e[30]).then(function(a){return a=a,e[31]=a[0],e[32]=a[1],a})},function(a){return e[33]=(e[25].push(e[31]),e[25])}])}):d.resolve()},function(a){return d.seq([function(a){return e[30]=d.createArray(),e[31]=d.i64.of_int32(e[25].length),d.i64.gt(e[31],d.i64.cast([0,0]))?d.loopAsync(e[31],function(a){return e[33]=a,d.seq([function(a){return d.ntop("Array",b("LSArrayGetObjectAt"),e[25],e[33]).then(function(a){return a=a,e[34]=a[0],e[35]=a[1],a})},function(a){return e[36]=(e[30].push(d.i64.to_string(e[34])),e[30])}])}):d.resolve()},function(a){return e[32]=e[30].join(","),e[27]=e[32]}])},function(a){return e[25].some(function(a){return d.i64.eq(e[15],a)})?e[28]=e[15]:e[28]=g,d.i64.neq(e[28],g)?e[29]=e[28]:e[29]=g,e[11]=e[29]}])},function(c){return d.i64.neq(e[11],g)?e[12]=e[11]:e[12]=d.i64.cast([0,0]),d.i64.neq(e[16],g)?e[13]=e[16]:e[13]=d.i64.cast([0,1]),d.i64.neq(e[17],g)?d.seq([function(c){return d.sp(b("LSLoadThreadPkFromThreadId"),a[0]).then(function(a){return a=a,e[20]=a[0],e[21]=a[1],a})},function(c){return d.i64.neq(e[20],g)?e[10]?d.seq([function(c){return e[22]=new d.Map(),e[22].set("act_thread_id",a[0]),d.nop(b("LSBase64Encode.nop"),e[18]).then(function(a){return a=a,e[23]=a[0],a})},function(a){return d.nop(b("LSBase64Encode.nop"),e[19]).then(function(a){return a=a,e[24]=a[0],a})},function(a){return e[25]=new d.Map(),e[25].set("ocmf_client_state_blob",e[23]==null?"":e[23]),e[25].set("mailbox_root_key",e[24]==null?"":e[24]),e[26]=d.createArray(),d.fe(d.ftr(d.db.table(169).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))}),function(a){a=a.item;return e[33]=(e[26].push(a.epochId),e[26])})},function(c){return e[27]=d.i64.of_int32(e[26].length),e[28]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",e[28],"Queried locally available epochs. Count: ",e[28],d.i64.to_string(e[27])].join("")),e[29]=new d.Map(),e[29].set("device_id",e[17]),e[29].set("raw_tokens",e[25]),e[29].set("locally_available_epochs",e[26]),e[30]=new d.Map(),e[30].set("reference_timestamp",a[2]),e[30].set("server_thread_key",g),e[30].set("device_context",e[29]),e[31]=new d.Map(),e[31].set("restore_context",e[22]),e[31].set("success",e[30]),e[32]=d.toJSON(e[31]),d.sp(b("LSIssueNewTask"),"encrypted_backups_restore",d.i64.cast([0,50031]),e[32],g,g,d.i64.cast([0,0]),d.i64.cast([0,0]),g,g,d.i64.cast([0,0]))}]):d.i64.gt(a[1],d.i64.cast([0,0]))?d.seq([function(c){return e[22]=new d.Map(),e[22].set("act_thread_id",a[0]),e[22].set("request_id",a[4]),d.nop(b("LSBase64Encode.nop"),e[18]).then(function(a){return a=a,e[23]=a[0],a})},function(a){return d.nop(b("LSBase64Encode.nop"),e[19]).then(function(a){return a=a,e[24]=a[0],a})},function(a){return e[25]=new d.Map(),e[25].set("ocmf_client_state_blob",e[23]==null?"":e[23]),e[25].set("mailbox_root_key",e[24]==null?"":e[24]),e[26]=d.createArray(),d.fe(d.ftr(d.db.table(169).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))}),function(a){a=a.item;return e[33]=(e[26].push(a.epochId),e[26])})},function(c){return e[27]=d.i64.of_int32(e[26].length),e[28]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",e[28],"Queried locally available epochs. Count: ",e[28],d.i64.to_string(e[27])].join("")),e[29]=new d.Map(),e[29].set("device_id",e[17]),e[29].set("raw_tokens",e[25]),e[29].set("locally_available_epochs",e[26]),e[30]=new d.Map(),e[30].set("reference_timestamp",a[2]),e[30].set("direction",d.i64.cast([0,1])),e[30].set("server_thread_key",g),e[30].set("device_context",e[29]),e[31]=new d.Map(),e[31].set("restore_context",e[22]),e[31].set("success",e[30]),e[32]=d.toJSON(e[31]),d.sp(b("LSIssueNewTask"),"encrypted_backups_restore",d.i64.cast([0,50030]),e[32],g,g,d.i64.cast([0,0]),d.i64.cast([0,0]),g,g,d.i64.cast([0,0]))}]):d.seq([function(c){return e[22]=new d.Map(),e[22].set("act_thread_id",a[0]),e[22].set("request_id",a[4]),d.nop(b("LSBase64Encode.nop"),e[18]).then(function(a){return a=a,e[23]=a[0],a})},function(a){return d.nop(b("LSBase64Encode.nop"),e[19]).then(function(a){return a=a,e[24]=a[0],a})},function(a){return e[25]=new d.Map(),e[25].set("ocmf_client_state_blob",e[23]==null?"":e[23]),e[25].set("mailbox_root_key",e[24]==null?"":e[24]),e[26]=d.createArray(),d.fe(d.ftr(d.db.table(169).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))}),function(a){a=a.item;return e[33]=(e[26].push(a.epochId),e[26])})},function(c){return e[27]=d.i64.of_int32(e[26].length),e[28]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",e[28],"Queried locally available epochs. Count: ",e[28],d.i64.to_string(e[27])].join("")),e[29]=new d.Map(),e[29].set("device_id",e[17]),e[29].set("raw_tokens",e[25]),e[29].set("locally_available_epochs",e[26]),e[30]=new d.Map(),e[30].set("reference_timestamp",a[2]),e[30].set("direction",d.i64.cast([0,2])),e[30].set("server_thread_key",g),e[30].set("device_context",e[29]),e[31]=new d.Map(),e[31].set("restore_context",e[22]),e[31].set("success",e[30]),e[32]=d.toJSON(e[31]),d.sp(b("LSIssueNewTask"),"encrypted_backups_restore",d.i64.cast([0,50030]),e[32],g,g,d.i64.cast([0,0]),d.i64.cast([0,0]),g,g,d.i64.cast([0,0]))}]):e[10]?(e[22]=new d.Map(),e[22].set("error_code",d.i64.cast([0,100])),e[22].set("error_message",""),e[22].set("stored_procedure","issueMessageRangeQueryTask"),e[23]=new d.Map(),e[23].set("act_thread_id",a[0]),e[24]=new d.Map(),e[24].set("restore_context",e[23]),e[24].set("failure",e[22]),e[25]=d.toJSON(e[24]),d.sp(b("LSIssueNewTask"),"encrypted_backups_restore",d.i64.cast([0,50031]),e[25],g,g,d.i64.cast([0,0]),d.i64.cast([0,0]),g,g,d.i64.cast([0,0]))):(e[22]=new d.Map(),e[22].set("error_code",d.i64.cast([0,100])),e[22].set("error_message",""),e[22].set("stored_procedure","issueMessageRangeQueryTask"),e[23]=new d.Map(),e[23].set("act_thread_id",a[0]),e[24]=new d.Map(),e[24].set("restore_context",e[23]),e[24].set("failure",e[22]),e[25]=d.toJSON(e[24]),d.sp(b("LSIssueNewTask"),"encrypted_backups_restore",d.i64.cast([0,50030]),e[25],g,g,d.i64.cast([0,0]),d.i64.cast([0,0]),g,g,d.i64.cast([0,0])))},function(a){return e[14]=!0}]):d.seq([function(c){return e[10]?(e[20]=new d.Map(),e[20].set("error_code",d.i64.cast([0,1])),e[20].set("error_message",""),e[20].set("stored_procedure","issueMessageRangeQueryTask"),e[21]=new d.Map(),e[21].set("act_thread_id",a[0]),e[22]=new d.Map(),e[22].set("restore_context",e[21]),e[22].set("failure",e[20]),e[23]=d.toJSON(e[22]),d.sp(b("LSIssueNewTask"),"encrypted_backups_restore",d.i64.cast([0,50031]),e[23],g,g,d.i64.cast([0,0]),d.i64.cast([0,0]),g,g,d.i64.cast([0,0]))):(e[20]=new d.Map(),e[20].set("error_code",d.i64.cast([0,1])),e[20].set("error_message",""),e[20].set("stored_procedure","issueMessageRangeQueryTask"),e[21]=new d.Map(),e[21].set("act_thread_id",a[0]),e[22]=new d.Map(),e[22].set("restore_context",e[21]),e[22].set("failure",e[20]),e[23]=d.toJSON(e[22]),d.sp(b("LSIssueNewTask"),"encrypted_backups_restore",d.i64.cast([0,50030]),e[23],g,g,d.i64.cast([0,0]),d.i64.cast([0,0]),g,g,d.i64.cast([0,0])))},function(a){return e[14]=!1}])},function(a){return e[8]=e[14]}]))})):(e[9]=function(a){return a==g?g:a}(c("qex")._("1228")),e[9]!==g?e[8]=e[9]:e[8]=!1,(c("gkx")("2012")||e[8])&&c("justknobx")._("1103")?d.seq([function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[10]=a[0],a})},function(c){return e[10]?e[11]=!0:e[11]=!1,e[11]?d.seq([function(c){return a[4]!==g?d.seq([function(a){return d.islc(d.ftr(d.db.table(168).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))&&d.i64.eq(a.backupTenancy,d.i64.cast([0,2]))}),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(a,b){b=a.done;a=a.value;return b?e[30]=!1:(a.item,e[30]=!0)})},function(c){return e[30]?e[32]=d.i64.or_(d.i64.cast([0,73]),d.i64.cast([0,128])):e[32]=d.i64.cast([0,73]),e[33]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",e[33],"EncryptedBackups MCD Trace ID",e[33],d.i64.to_string(e[32])].join("")),d.sp(b("LSCreateDataTrace"),a[4],g,g,"restore_messages",e[32])},function(b){return e[29]=a[4]}]):d.seq([function(a){return d.islc(d.ftr(d.db.table(168).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))&&d.i64.eq(a.backupTenancy,d.i64.cast([0,2]))}),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(a,b){b=a.done;a=a.value;return b?e[30]=!1:(a.item,e[30]=!0)})},function(a){return e[30]?e[32]=d.i64.or_(d.i64.cast([0,73]),d.i64.cast([0,128])):e[32]=d.i64.cast([0,73]),d.nop(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,e[33]=a[0],a})},function(a){return e[34]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",e[34],"EncryptedBackups MCD Trace ID",e[34],d.i64.to_string(e[32])].join("")),d.sp(b("LSCreateDataTrace"),e[33],g,g,"restore_messages",e[32])},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[35]=a[0],a})},function(a){return e[35]?e[36]=!0:e[36]=!1,e[36]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[37]=d.createArray(),g!==g?e[38]=(e[37].push(g),e[37]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[37],d.i64.cast([0,3]))):d.resolve()},function(a){return e[29]=e[33]}])},function(a){return e[12]=e[29]}]):d.seq([function(a){return d.islc(d.ftr(d.db.table(168).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))&&d.i64.eq(a.backupTenancy,d.i64.cast([0,2]))}),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(a,b){b=a.done;a=a.value;return b?e[29]=!1:(a.item,e[29]=!0)})},function(a){return e[29]?e[31]=d.i64.or_(d.i64.cast([0,73]),d.i64.cast([0,128])):e[31]=d.i64.cast([0,73]),d.nop(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,e[32]=a[0],a})},function(a){return e[33]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",e[33],"EncryptedBackups MCD Trace ID",e[33],d.i64.to_string(e[31])].join("")),d.sp(b("LSCreateDataTrace"),e[32],g,g,"restore_messages",e[31])},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[34]=a[0],a})},function(a){return e[34]?e[35]=!0:e[35]=!1,e[35]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[36]=d.createArray(),g!==g?e[37]=(e[36].push(g),e[36]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[36],d.i64.cast([0,3]))):d.resolve()},function(a){return e[12]=e[32]}])},function(a){return e[12]!==g?d.sp(b("LSAppendDataTraceAddon"),e[12],d.i64.cast([0,1421]),d.i64.cast([0,2]),g,g):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[13]=a[0],a})},function(a){return e[13]?e[14]=!0:e[14]=!1,e[14]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[29]=d.createArray(),g!==g?e[30]=(e[29].push(g),e[29]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[29],d.i64.cast([0,3]))):d.resolve()},function(a){return d.islc(d.ftr(d.db.table(168).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))}),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(a,c){var f=a.done;a=a.value;return f?(f=[g,g,g,g,g,d.i64.cast([0,1]),g,g,g,g,g,g,g],e[15]=f[0],e[16]=f[1],e[17]=f[2],e[18]=f[3],e[19]=f[4],e[20]=f[5],e[21]=f[6],e[22]=f[7],e[23]=f[8],e[24]=f[9],e[25]=f[10],e[26]=f[11],e[27]=f[12],f):(c=a.item,d.seq([function(a){return e[33]=c.backupTenancy,e[32]=c.encryptionVersion,d.i64.neq(g,g)?d.resolve(e[29]=g):d.seq([function(a){return e[34]=d.createArray(),d.sp(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,0])).then(function(a){return a=a,e[35]=a[0],a})},function(a){return e[35]?e[44]=(e[34].push(d.i64.cast([0,0])),e[34]):0,d.sp(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,2])).then(function(a){return a=a,e[36]=a[0],a})},function(a){return e[36]?e[44]=(e[34].push(d.i64.cast([0,2])),e[34]):0,d.sp(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,3])).then(function(a){return a=a,e[37]=a[0],a})},function(a){return e[37]?e[44]=(e[34].push(d.i64.cast([0,3])),e[34]):0,d.sp(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,4])).then(function(a){return a=a,e[38]=a[0],a})},function(a){return e[38]?e[44]=(e[34].push(d.i64.cast([0,4])),e[34]):0,e[39]=d.createArray(),e[40]=d.i64.of_int32(e[34].length),d.i64.gt(e[40],d.i64.cast([0,0]))?d.loopAsync(e[40],function(a){return e[44]=a,d.seq([function(a){return d.ntop("Array",b("LSArrayGetObjectAt"),e[34],e[44]).then(function(a){return a=a,e[45]=a[0],e[46]=a[1],a})},function(a){return e[47]=(e[39].push(e[45]),e[39])}])}):d.resolve()},function(a){return d.seq([function(a){return e[44]=d.createArray(),e[45]=d.i64.of_int32(e[39].length),d.i64.gt(e[45],d.i64.cast([0,0]))?d.loopAsync(e[45],function(a){return e[47]=a,d.seq([function(a){return d.ntop("Array",b("LSArrayGetObjectAt"),e[39],e[47]).then(function(a){return a=a,e[48]=a[0],e[49]=a[1],a})},function(a){return e[50]=(e[44].push(d.i64.to_string(e[48])),e[44])}])}):d.resolve()},function(a){return e[46]=e[44].join(","),e[41]=e[46]}])},function(a){return e[39].some(function(a){return d.i64.eq(e[32],a)})?e[42]=e[32]:e[42]=g,d.i64.neq(e[42],g)?e[43]=e[42]:e[43]=g,e[29]=e[43]}])},function(a){return d.i64.neq(e[29],g)?e[30]=e[29]:e[30]=d.i64.cast([0,0]),d.i64.neq(e[33],g)?e[31]=e[33]:e[31]=d.i64.cast([0,1]),a=[c.backupId,c.deviceId,c.mailboxRootKeyBlob,c.ocmfClientStateBlob,e[30],e[31],c.epochAuthPublicKeyBlob,c.epochAuthPrivateKeyBlob,c.devicePublicKeyBlob,c.devicePrivateKeyBlob,c.epochStoragePublicKeyBlob,c.epochStoragePrivateKeyBlob,c.obliviousValidationTokenBlob],e[15]=a[0],e[16]=a[1],e[17]=a[2],e[18]=a[3],e[19]=a[4],e[20]=a[5],e[21]=a[6],e[22]=a[7],e[23]=a[8],e[24]=a[9],e[25]=a[10],e[26]=a[11],e[27]=a[12],a}]))})},function(c){return d.i64.neq(e[15],g)?d.blobs.neq(e[18],g)?d.seq([function(c){return d.i64.gt(a[1],d.i64.cast([0,0]))&&d.i64.gt(a[5],d.i64.cast([0,0]))?d.seq([function(a){return e[12]!==g?d.sp(b("LSAppendDataTraceAddon"),e[12],d.i64.cast([0,2515]),d.i64.cast([0,2]),g,g):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[42]=a[0],a})},function(a){return e[42]?e[43]=!0:e[43]=!1,e[43]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[44]=d.createArray(),g!==g?e[45]=(e[44].push(g),e[44]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[44],d.i64.cast([0,3]))):d.resolve()}]):d.i64.gt(a[5],d.i64.cast([0,0]))?d.seq([function(a){return e[12]!==g?d.sp(b("LSAppendDataTraceAddon"),e[12],d.i64.cast([0,2514]),d.i64.cast([0,2]),g,g):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[42]=a[0],a})},function(a){return e[42]?e[43]=!0:e[43]=!1,e[43]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[44]=d.createArray(),g!==g?e[45]=(e[44].push(g),e[44]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[44],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(c){return d.nop(b("LSGetBlobFromString.nop"),a[0]).then(function(a){return a=a,e[29]=a[0],a})},function(a){return d.nop(b("LSHmac_v2.nop"),d.blob("dGhyZWFkX2lkX3Njb3Bl"),e[29]).then(function(a){return a=a,e[30]=a[0],a})},function(a){return d.nop(b("LSOcmfClientMap.nop"),e[18],e[30]).then(function(a){return a=a,e[31]=a[0],a})},function(a){return d.nop(b("LSBase64Encode.nop"),e[31]).then(function(a){return a=a,e[32]=a[0],a})},function(a){return e[41]=e[32]==null?"":e[32],d.nop(b("LSGetBlobFromString.nop"),d.i64.to_string(e[15])).then(function(a){return a=a,e[33]=a[0],a})},function(a){return d.nop(b("LSHmac_v2.nop"),d.blob("bWFpbGJveF9pZF9zY29wZQ=="),e[33]).then(function(a){return a=a,e[34]=a[0],a})},function(a){return d.nop(b("LSOcmfClientMap.nop"),e[18],e[34]).then(function(a){return a=a,e[35]=a[0],a})},function(a){return d.nop(b("LSBase64Encode.nop"),e[35]).then(function(a){return a=a,e[36]=a[0],a})},function(c){return d.blobs.neq(e[17],g)?d.seq([function(c){return a[2]!==g?d.seq([function(c){return e[43]=d.createArray(),e[49]=(e[43].push(d.i64.cast([0,32])),e[43]),d.nop(b("LSGetBlobFromString.nop"),["thread_ope_key","_",a[0]].join("")).then(function(a){return a=a,e[44]=a[0],a})},function(a){return d.nop(b("LSCreateDerivedKeys.nop"),e[44],g,e[17],e[43]).then(function(a){return a=a,e[45]=a[0],a})},function(a){return e[45]?e[46]=!1:e[46]=!0,e[46]?d.seq([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),e[49]=d.createArray(),g!==g?e[50]=(e[49].push(g),e[49]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","Got null keys while deriving message list OPE key. Returning null blobish",e[49],d.i64.cast([0,3]))},function(a){return e[47]=g}]):d.seq([function(a){return d.ntop("Array",b("LSArrayGetObjectAt"),e[45],d.i64.cast([0,0])).then(function(a){return a=a,e[49]=a[0],e[50]=a[1],a})},function(a){return e[47]=e[49]}])},function(c){return d.blobs.neq(e[47],g)?d.seq([function(c){return d.nop(b("LSGetBlobFromInt64BE.nop"),d.i64.from_string(a[2])).then(function(a){return a=a,e[49]=a[0],a})},function(a){return d.nop(b("LSTruncateSortKey.nop"),e[49]).then(function(a){return a=a,e[50]=a[0],a})},function(a){return d.nop(b("LSOpeEncrypt.nop"),e[47],e[50],d.i64.cast([0,16])).then(function(a){return a=a,e[51]=a[0],a})},function(a){return d.nop(b("LSBinaryToHex.nop"),e[51]).then(function(a){return a=a,e[52]=a[0],a})},function(a){return e[48]=e[52]==null?"":e[52]}]):d.seq([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] OPE key is null"),e[49]=d.createArray(),g!==g?e[50]=(e[49].push(g),e[49]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","OPE key is null",e[49],d.i64.cast([0,3]))},function(a){return e[48]=g}])},function(a){return e[42]=e[48]}]):d.resolve(e[42]=g)},function(a){return e[37]=e[42]}]):d.seq([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Mailbox root key is null"),e[42]=d.createArray(),g!==g?e[43]=(e[42].push(g),e[42]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","Mailbox root key is null",e[42],d.i64.cast([0,3]))},function(a){return e[37]=g}])},function(c){return a[0]!==g?d.seq([function(c){return d.nop(b("LSGetThreadTransportIdFromThreadId.nop"),a[0]).then(function(a){return a=a,e[42]=a[0],a})},function(a){return d.i64.neq(e[42],g)?d.seq([function(a){return d.db.table(173).fetch([[[e[42]]],"jid"]).next().then(function(a,b){var c=a.done;a=a.value;return c?e[44]=g:(b=a.item,e[44]=d.i64.to_string(b.serverThreadKey))})},function(a){return e[43]=e[44]}]):d.seq([function(a){return function(a){d.logger(a).warn(a)}("[EncryptedBackups][MEBTableUtils] Failed to get server thread key, wa jid is null"),e[44]=d.createArray(),g!==g?e[45]=(e[44].push(g),e[44]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTableUtils","Failed to get server thread key, wa jid is null",e[44],d.i64.cast([0,2]))},function(a){return e[43]=g}])},function(a){return e[38]=e[43]}]):d.seq([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTableUtils] Failed to get server thread key, thread id is null"),e[42]=d.createArray(),g!==g?e[43]=(e[42].push(g),e[42]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTableUtils","Failed to get server thread key, thread id is null",e[42],d.i64.cast([0,3]))},function(a){return e[38]=g}])},function(c){return d.nop(b("LSGetThreadTransportIdFromThreadId.nop"),a[0]).then(function(a){return a=a,e[39]=a[0],a})},function(c){return d.sp(b("LSIssueRestoreTask"),e[36]==null?"":e[36],e[41],a[1],d.i64.cast([0,1]),e[37],e[12],a[3],a[5],a[2],e[38],e[39]).then(function(a){return a=a,e[40]=a[0],a})},function(b){return d.i64.neq(e[40],g)?d.db.table(180).add({taskId:e[40],listId:e[41],threadId:a[0]}):d.resolve()}]):(e[29]="Missing ocmf_client_state for IssueMessageRangeQueryTask",e[29]!==g?d.seq([function(a){return e[33]=["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",e[29]].join(""),function(a){d.logger(a).mustfix(a)}(e[33]),e[30]=d.createArray(),e[12]!==g?e[34]=(e[30].push(e[12]),e[30]):0,d.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",e[29],e[30],d.i64.cast([0,3]))},function(a){return e[12]!==g?d.seq([function(a){return e[12]!==g?d.sp(b("LSAppendDataTraceAddon"),e[12],d.i64.cast([0,85]),d.i64.cast([0,2]),e[33],g):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[34]=a[0],a})},function(a){return e[34]?e[35]=!0:e[35]=!1,e[35]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[36]=d.createArray(),g!==g?e[37]=(e[36].push(g),e[36]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[36],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(a){return e[12]!==g?d.nop(b("LSFlushDataTrace.nop"),e[12]):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[31]=a[0],a})},function(a){return e[31]?e[32]=!0:e[32]=!1,e[32]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[34]=d.createArray(),g!==g?e[35]=(e[34].push(g),e[34]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[34],d.i64.cast([0,3]))):d.resolve()}]):d.seq([function(a){return e[12]!==g?d.seq([function(a){return e[12]!==g?d.sp(b("LSAppendDataTraceAddon"),e[12],d.i64.cast([0,85]),d.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",""].join(""),g):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[32]=a[0],a})},function(a){return e[32]?e[33]=!0:e[33]=!1,e[33]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[34]=d.createArray(),g!==g?e[35]=(e[34].push(g),e[34]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[34],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(a){return e[12]!==g?d.nop(b("LSFlushDataTrace.nop"),e[12]):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[30]=a[0],a})},function(a){return e[30]?e[31]=!0:e[31]=!1,e[31]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[32]=d.createArray(),g!==g?e[33]=(e[32].push(g),e[32]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[32],d.i64.cast([0,3]))):d.resolve()}])):(e[29]="Missing backup_id for IssueMessageRangeQueryTask",e[29]!==g?d.seq([function(a){return e[33]=["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",e[29]].join(""),function(a){d.logger(a).mustfix(a)}(e[33]),e[30]=d.createArray(),e[12]!==g?e[34]=(e[30].push(e[12]),e[30]):0,d.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",e[29],e[30],d.i64.cast([0,3]))},function(a){return e[12]!==g?d.seq([function(a){return e[12]!==g?d.sp(b("LSAppendDataTraceAddon"),e[12],d.i64.cast([0,85]),d.i64.cast([0,2]),e[33],g):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[34]=a[0],a})},function(a){return e[34]?e[35]=!0:e[35]=!1,e[35]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[36]=d.createArray(),g!==g?e[37]=(e[36].push(g),e[36]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[36],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(a){return e[12]!==g?d.nop(b("LSFlushDataTrace.nop"),e[12]):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[31]=a[0],a})},function(a){return e[31]?e[32]=!0:e[32]=!1,e[32]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[34]=d.createArray(),g!==g?e[35]=(e[34].push(g),e[34]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[34],d.i64.cast([0,3]))):d.resolve()}]):d.seq([function(a){return e[12]!==g?d.seq([function(a){return e[12]!==g?d.sp(b("LSAppendDataTraceAddon"),e[12],d.i64.cast([0,85]),d.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",""].join(""),g):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[32]=a[0],a})},function(a){return e[32]?e[33]=!0:e[33]=!1,e[33]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[34]=d.createArray(),g!==g?e[35]=(e[34].push(g),e[34]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[34],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(a){return e[12]!==g?d.nop(b("LSFlushDataTrace.nop"),e[12]):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[30]=a[0],a})},function(a){return e[30]?e[31]=!0:e[31]=!1,e[31]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[32]=d.createArray(),g!==g?e[33]=(e[32].push(g),e[32]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[32],d.i64.cast([0,3]))):d.resolve()}]))}]):(e[10]="paged restore is disabled",e[10]!==g?d.seq([function(c){return e[14]=["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",e[10]].join(""),function(a){d.logger(a).mustfix(a)}(e[14]),e[11]=d.createArray(),a[4]!==g?e[15]=(e[11].push(a[4]),e[11]):0,d.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",e[10],e[11],d.i64.cast([0,3]))},function(c){return a[4]!==g?d.seq([function(c){return a[4]!==g?d.sp(b("LSAppendDataTraceAddon"),a[4],d.i64.cast([0,85]),d.i64.cast([0,2]),e[14],g):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[15]=a[0],a})},function(a){return e[15]?e[16]=!0:e[16]=!1,e[16]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[17]=d.createArray(),g!==g?e[18]=(e[17].push(g),e[17]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[17],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(c){return a[4]!==g?d.nop(b("LSFlushDataTrace.nop"),a[4]):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[12]=a[0],a})},function(a){return e[12]?e[13]=!0:e[13]=!1,e[13]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[15]=d.createArray(),g!==g?e[16]=(e[15].push(g),e[15]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[15],d.i64.cast([0,3]))):d.resolve()}]):d.seq([function(c){return a[4]!==g?d.seq([function(c){return a[4]!==g?d.sp(b("LSAppendDataTraceAddon"),a[4],d.i64.cast([0,85]),d.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",""].join(""),g):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[13]=a[0],a})},function(a){return e[13]?e[14]=!0:e[14]=!1,e[14]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[15]=d.createArray(),g!==g?e[16]=(e[15].push(g),e[15]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[15],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(c){return a[4]!==g?d.nop(b("LSFlushDataTrace.nop"),a[4]):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[11]=a[0],a})},function(a){return e[11]?e[12]=!0:e[12]=!1,e[12]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[13]=d.createArray(),g!==g?e[14]=(e[13].push(g),e[13]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[13],d.i64.cast([0,3]))):d.resolve()}])))},function(a){return e[1]=d.i64.of_float(Date.now()),e[3]="Finishing execution. Execution time: ",e[4]=d.i64.to_string(d.i64.sub(e[1],e[0])),e[6]=" ms",e[2]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ",e[2],e[3],e[2],e[4],e[2],e[6]].join("")),e[5]=",",e[7]=d.createArray(),g!==g?e[8]=(e[7].push(g),e[7]):0,d.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",[e[3],e[5],e[4],e[5],e[6]].join(""),e[7],d.i64.cast([0,4]))}])},function(a){return d.resolve(f)}])}d=a;g["default"]=d}),98);
__d("MWEncryptedBackupsIssueRangeQuery.bs",["I64","LSEncryptedBackupsBackupTenancy","LSFactory","LSIntEnum","LSIssueMessageRangeQueryTask","MAWEncryptedBackupUtils","MAWJidUtils","MAWUIThreadCache","Promise","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a,e,f,g,h){if(c("gkx")("7958")){c("promiseDone")(d("MAWEncryptedBackupUtils").getBackupTenancy(a).then(function(i){if(i!=null&&d("I64").equal(i,d("LSIntEnum").ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION)))return d("MAWUIThreadCache").getThreadJidByChatId({threadId:e}).then(function(e){if(e==null)return b("Promise").resolve();else return a.runInTransaction(function(a){return c("LSIssueMessageRangeQueryTask")(d("MAWJidUtils").threadIdForChatJid(e),g,d("I64").to_string(f),!1,void 0,h,c("LSFactory")(a))},"readwrite")});else return b("Promise").resolve()}));return}}g.runQuery=a}),98);